{"ast":null,"code":"'use strict';\n\nconst utils = require('../utils');\n\nconst define = (obj, name, value) => Reflect.defineProperty(obj, name, {\n  value\n});\n\nmodule.exports = function () {\n  let options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  return function () {\n    var _this = this;\n\n    let log = function () {\n      if (_this.options.verbose === true || options.verbose === true) {\n        console.log(...arguments);\n      }\n    };\n\n    define(this, 'total', async () => {\n      if (!this.cache.has('total')) {\n        let results = await this.downloads();\n        this.cache.set('total', utils.stats.calc.total(results));\n      }\n\n      return this.cache.get('total');\n    });\n    define(this, 'last', async n => {\n      let key = 'last-' + n;\n\n      if (!this.cache.has(key)) {\n        let results = await this.downloads();\n        this.cache.set(key, utils.stats.calc.last(n, results));\n      }\n\n      return this.cache.get(key);\n    });\n    define(this, 'downloads', function () {\n      let start = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '2005-01-01';\n      let end = _this.options.end ? utils.moment(_this.options.end) : utils.moment.utc().subtract(1, 'days');\n      start = utils.moment(start);\n      let downloads = [];\n      return new Promise((resolve, reject) => {\n        log('getting downloads for \"' + _this.name + '\"');\n        utils.stats.get(start, end, _this.name).on('data', data => {\n          downloads.push(data);\n        }).on('error', err => {\n          log('ERROR: [' + _this.name + ']');\n          log(err);\n        }).on('end', () => {\n          downloads.sort((a, b) => {\n            if (a.day < b.day) return 1;\n            if (a.day > b.day) return -1;\n            return 0;\n          });\n          let results = [];\n          downloads.forEach(download => {\n            if (!results.find(d => d.day === download.day)) {\n              results.push(download);\n            }\n          });\n          resolve(results);\n        });\n      });\n    });\n  };\n};","map":{"version":3,"sources":["C:/Users/LPT158/Desktop/project/New folder/reactpro/node_modules/npm-api/lib/plugins/downloads.js"],"names":["utils","require","define","obj","name","value","Reflect","defineProperty","module","exports","options","log","verbose","console","cache","has","results","downloads","set","stats","calc","total","get","n","key","last","start","end","moment","utc","subtract","Promise","resolve","reject","on","data","push","err","sort","a","b","day","forEach","download","find","d"],"mappings":"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","sourcesContent":["'use strict';\n\nconst utils = require('../utils');\nconst define = (obj, name, value) => Reflect.defineProperty(obj, name, { value });\n\nmodule.exports = (options = {}) => {\n  return function() {\n    let log = (...args) => {\n      if (this.options.verbose === true || options.verbose === true) {\n        console.log(...args);\n      }\n    };\n\n    define(this, 'total', async() => {\n      if (!this.cache.has('total')) {\n        let results = await this.downloads();\n        this.cache.set('total', utils.stats.calc.total(results));\n      }\n      return this.cache.get('total');\n    });\n\n    define(this, 'last', async(n) => {\n      let key = 'last-' + n;\n      if (!this.cache.has(key)) {\n        let results = await this.downloads();\n        this.cache.set(key, utils.stats.calc.last(n, results));\n      }\n      return this.cache.get(key);\n    });\n\n    define(this, 'downloads', (start = '2005-01-01') => {\n      let end = this.options.end\n        ? utils.moment(this.options.end)\n        : utils.moment.utc().subtract(1, 'days');\n\n      start = utils.moment(start);\n      let downloads = [];\n      return new Promise((resolve, reject) => {\n        log('getting downloads for \"' + this.name + '\"');\n        utils.stats.get(start, end, this.name)\n          .on('data', (data) => {\n            downloads.push(data);\n          })\n          .on('error', (err) => {\n            log('ERROR: [' + this.name + ']');\n            log(err);\n          })\n          .on('end', () => {\n            downloads.sort((a, b) => {\n              if (a.day < b.day) return 1;\n              if (a.day > b.day) return -1;\n              return 0;\n            });\n            let results = [];\n            downloads.forEach(download => {\n              if (!results.find(d => d.day === download.day)) {\n                results.push(download);\n              }\n            });\n            resolve(results);\n          });\n      });\n    });\n  };\n};\n"]},"metadata":{},"sourceType":"script"}